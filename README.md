# 表达式（四则运算）计算的算法 C#

## 基本知识点
>[逆波兰表达式](http://note.youdao.com/noteshare?id=a27c8fb252221c063b1c5bb6501ac561)

>[参考连接](https://blog.csdn.net/luoweifu/article/details/10477447)

&emsp;&emsp;通常我们所看到的算术表达式，运算符总是在两个操作数中间(除)，如(A+B)*C，这样的表达式叫做`**中缀表达式**`。这种表达式不同的运算符优先级不同，而且通常含有括号，计算机很难理解这种表达式。在编译系统中，要把人易于理解的表达式翻译成能正确求值的机器指令。编译系统中对中缀形式的算术表达式的处理方式是: 先把中缀表达式转换成`**后缀表达式**`，再进行计算。

&emsp;&emsp;**后缀表达式**就是表达式中的运算符出现在操作数的后面，并且不含括号，如AB+C*。后缀表达式的特点：

1. 后缀表达式让操作数和中缀表达式的操作数先后次序相同，只是运算符的先后次序改变；
2. 后缀表达式没有括号，运算次序就是其执行次序。

&emsp;&emsp;在计算机内部，任何一个表达式都是由操作数、运算符和分界符组成。操作数和运算符是表达式的主要部分，分界符(如用#表示)标志了一个表达式的结束。我们把操作数、运算符和分界符称为表达式的单词。

一个中缀表达式的四则运算规则：

1. 先乘除后加减

2. 先括号内后括号外

3. 同级别时先左后右


下面以`A+(B-C/D)*E`为例对过程进行讲解。`A+(B-C/D)*E`转换成后缀表达式后为`ABCD/-E*+`

其运算次序为：`T1=CD/; T2=BT1-; T3=T2E*; T4=AT3+`。

&emsp;&emsp;基于后缀表达式的两个特点，计算过程如下：计算时只要从左到右依次扫描后缀表达式的各个单词，当读到的单词为运算符时，就对该运算他会前两个操作数进施以此运算所代表的操作，然后将结果T插入到后缀表达式中再重复上面的操作。

## 实现步骤

1. 把中缀表达式的字符中提取出一系列表达式单词；
2. 把中缀表达式单词系列转换成后缀表达式单词系列；
3. 对后缀表达式词系列依次进行计算。

## 使用
``` C#
new Calculator("expression").Run();
```
## 逆波兰表达式的一般算法

&emsp;&emsp;首先需要分配2个栈，一个作为临时存储运算符的栈S1（含一个结束符号），一个作为输入逆波兰式的栈S2（空栈），S1栈可先放入优先级最低的运算符#，注意，中缀式应以此最低优先级的运算符结束。可指定其他字符，不一定非#不可。从中缀式的左端开始取字符，逐序进行如下步骤：
&emsp;1. 若取出的字符是操作数，则分析出完整的运算数，该操作数直接送入S2栈
&emsp;2. 若取出的字符是运算符，则将该运算符与S1栈栈顶元素比较，如果该运算符优先级大于S1栈栈顶运算符优先级，则将该运算符进S1栈，否则，将S1栈的栈顶运算符弹出，送入S2栈中，直至S1栈栈顶运算符低于（不包括等于）该运算符优先级，则将该运算符送入S1栈。
&emsp;3. 若取出的字符是“（”，则直接送入S1栈栈顶。
&emsp;4. 若取出的字符是“）”，则将距离S1栈栈顶最近的“（”之间的运算符，逐个出栈，依次送入S2栈，此时抛弃“（”。
&emsp;5. 重复上面的1~4步，直至处理完所有的输入字符
&emsp;6. 若取出的字符是“#”，则将S1栈内所有运算符（不包括“#”），逐个出栈，依次送入S2栈。

